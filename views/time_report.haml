%table#timereport
  %caption
    = "#{@time_report.project_name}:"
    = @time_report.period.first.strftime("%F")
    through
    = @time_report.period.last.strftime("%F")
  %thead
    %tr
      %th Task
      %th Pivotal Name
      %th Story Type
      %th Pivotal Points
      %th Pivotal Status
      %th True Points
      %th % of Total Hours This Period
      - @time_report.users.each do |user|
        %th= user.name
      %th Total Hours This Period
      %th Lifetime Hours
      %th Lifetime Hours / Point
  %tbody
    - @time_report.tasks.each do |task|
      %tr{ :class => task.points_estimate_quality }
        %td.name= task[:name]
        %td= task[:pivotal_name]
        %td= task[:story_type]
        %td.points.number= task[:points]
        %td= task[:status]
        - if task.blowout?
          %td.points.blowout &infin;
        - else
          %td.points.number= task[:actual_points]
        %td.number= task[:time_this_period_percent]
        - @time_report.users.each do |user|
          %td.number
            - if time = task[:time_by_user][user.id]
              = time.to_hours
        %td.total.number= task[:time_this_period].to_hours
        %td.number= "%.2f" % task[:lifetime_hours]
        %td.number= "%.2f" % (task[:lifetime_hours] / task[:points]) rescue ''
  %tbody.subtotals
    - @time_report.subtotals.each do |total|
      %tr
        %td.name= total[:name]
        - 2.times do
          %td
        %td.number= total[:points]
        %td
        %td
        %td.number= "%.2f %%" % total[:time_this_period_percent]
        - @time_report.users.each do |user|
          %td.number
            - if time = total[:time_by_user][user.id]
              = time.to_hours
        %td.number= total[:time_this_period].to_hours
        %td.number= "%.2f" % total[:lifetime_hours]
        %td
  %tbody.totals
    %tr
      %td.name= @time_report.totals[:name]
      - 2.times do
        %td
      %td.number= @time_report.totals[:points]
      %td
      %td
      %td
      - @time_report.users.each do |user|
        %td.number
          - if time = @time_report.totals[:time_by_user][user.id]
            = time.to_hours
      %td.number= @time_report.totals[:time_this_period].to_hours
      %td.number= "%.2f" % @time_report.totals[:lifetime_hours]
      %td

%p
  Team strength for the period
  = @time_report.team_strength
